/**
 * ember-parallel - v0.1.0
 * Copyright: 2014 Ben Gillies
 * License: BSD License (see https://raw.github.com/bengillies/ember-parallel/master/LICENSE)
 */

Em.Object.reopen({toJSON:function(){var a,b=[],c={};if(this.toArray)return this.toArray().map(function(a){return a&&a.toJSON?a.toJSON():a});for(var d in this)a=this[d],"toString"!==a&&"function"!==Ember.typeOf(a)&&"class"!==Em.typeOf(a)&&"concatenatedProperties"!==d&&"isDestroyed"!==d&&"isDestroying"!==d&&(a&&a.toArray?c[d]=a.toArray().map(function(a){return a&&a.toJSON?a.toJSON():a}):a&&a.toJSON&&(c[d]=a.toJSON()),b.push(d));return $.extend(this.getProperties.apply(this,b),c)}}),Em.JSONify=function(a){return a?a.toJSON?a.toJSON():a.toArray?a.toArray().map(function(a){return a&&a.toJSON?a.toJSON():a}):void 0:a},function(){function a(a,b){var c=a.get("parallelDependencies");for(var d in c)c.hasOwnProperty(d)&&b.require({name:d,fn:c[d]})}function b(a){return new Em.RSVP.Promise(function(b){a.then(function(a){b(a)})})}Em.parallelConfig={maxWorkers:4,evalPath:null},Em.computed.parallel={map:function(c,d,e){return Em.computed.promise(c+".[]",function(){var e=new Parallel(Em.JSONify(this.get(c)),Em.parallelConfig);return a(this,e),b(e.map(d))},e)},reduce:function(c,d,e){return Em.computed.promise(c+".[]",function(){var e=new Parallel(Em.JSONify(this.get(c)),Em.parallelConfig);return a(this,e),b(e.reduce(d))},e)},spawn:function(c,d,e){var f=c.replace(/(\.\[\]|\.@each.*)$/,"");return Em.computed.promise(c,function(){var c=new Parallel(Em.JSONify(this.get(f)),Em.parallelConfig);return a(this,c),b(c.spawn(d))},e)}}}(),Em.computed.promise=function(){var a=arguments[arguments.length-1],b=arguments.length-("function"==typeof a?1:2),c=[].slice.call(arguments,0,arguments.length-2),d=arguments[b];a=arguments[b+1];var e=function(b,c){if(2==arguments.length)return c;var e=this;return e.set(b+"Promise",new Em.RSVP.Promise(function(a){a(d.call(e))}).then(function(a){return e.get(b)!==a&&e.set(b,a),a})),a};return c.push(e),Em.computed.apply(Em.computed,c)};