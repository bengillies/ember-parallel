/**
 * ember-parallel - v0.0.2
 * Copyright: 2014 Ben Gillies
 * License: BSD License (see https://raw.github.com/bengillies/ember-parallel/master/LICENSE)
 */

Em.Object.reopen({toJSON:function(){var a,b=[],c={};if(this.toArray)return this.toArray().map(function(a){return a&&a.toJSON?a.toJSON:a});for(var d in this)a=this[d],"toString"!==a&&"function"!==Ember.typeOf(a)&&"class"!==Em.typeOf(a)&&"concatenatedProperties"!==d&&"isDestroyed"!==d&&"isDestroying"!==d&&(a&&a.toArray?c[d]=a.toArray().map(function(a){return a&&a.toJSON?a.toJSON():a}):a&&a.toJSON&&(c[d]=a.toJSON()),b.push(d));return $.extend(this.getProperties.apply(this,b),c)}}),Em.JSONify=function(a){return a?a.toJSON?a.toJSON():a.toArray?a.toArray().map(function(a){return a&&a.toJSON?a.toJSON():a}):void 0:a},Em.computed.parallel={map:function(a,b){return Em.computed.promise(a+".[]",function(){return new Parallel(Em.JSONify(this.get(a))).map(b)},[])},reduce:function(a,b,c){return Em.computed.promise(a+".[]",function(){return new Parallel(Em.JSONify(this.get(a))).reduce(b)},c)},spawn:function(a,b,c){return a=a.replace(/(\.\[\]|\.@each.*)$/,""),Em.computed.promise(a,function(){return new Parallel(Em.JSONify(this.get(a))).spawn(b)},c)}},Em.computed.promise=function(){var a=arguments[arguments.length-1],b=arguments.length-("function"==typeof a?1:2),c=[].slice.call(arguments,0,arguments.length-2),d=arguments[b];a=arguments[b+1];var e=function(b,c){if(2==arguments.length)return c;var e=this;return e.set(b+"Promise",new Em.RSVP.Promise(function(a){a(d.call(e))}).then(function(a){return e.get(b)!==a&&e.set(b,a),a})),a};return c.push(e),Em.computed.apply(Em.computed,c)};